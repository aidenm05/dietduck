<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meal Recommender</title>
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <div class="container">
    <h1>Meal Recommender</h1>

    <div class="selectors">
      <select id="restaurantSelect">
      </select>

      <select id="mealSelect">
        <option value="breakfast">Breakfast</option>
        <option value="lunch">Lunch</option>
        <option value="dinner">Dinner</option>
      </select>

      <button onclick="getRecommendations()">Get Recommendations</button>
    </div>

    <div id="results"></div>

    <div class="footer">
      <span id="current-time"></span>
    </div>
  </div>

  <script>
    window.onload = async () => {
      const response = await fetch('http://localhost:3000/api/restaurants');
      const restaurants = await response.json();
      const restaurantSelect = document.getElementById('restaurantSelect');

      restaurants.forEach(restaurant => {
        let option = document.createElement('option');
        option.value = restaurant;
        option.textContent = restaurant;
        restaurantSelect.appendChild(option);
      });

      updateTime();
      setInterval(updateTime, 1000);
    };

    function updateTime() {
      const now = new Date();
      document.getElementById('current-time').textContent = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }

    async function getRecommendations() {
      const restaurant = document.getElementById('restaurantSelect').value;
      const mealType = document.getElementById('mealSelect').value;

      document.getElementById('results').innerHTML = '<div class="loading">Loading recommendations...</div>';

      try {
        const response = await fetch('http://localhost:3000/api/recommendations', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ restaurantName: restaurant, mealType })
        });

        const data = await response.json();
        document.getElementById('results').innerHTML = formatMealRecommendations(data);
      } catch (error) {
        alert('Error getting recommendations');
        console.error(error);
      }
    }

    function formatMealRecommendations(data) {
      let html = `<h2>${data.restaurant}</h2>`;

      if (data.recommendations && data.recommendations.meals) {
        html += '<div class="meal-options">';
        data.recommendations.meals.forEach(meal => {
          html += `
            <div class="meal-option">
              <h3>${meal.name}</h3>
              <p>${meal.description}</p>
              <div class="macros-grid">
                <div class="macro-item"><span class="macro-label">Cal</span><span class="macro-value">${meal.macros.calories}</span></div>
                <div class="macro-item"><span class="macro-label">Protein</span><span class="macro-value">${meal.macros.protein}g</span></div>
                <div class="macro-item"><span class="macro-label">Carbs</span><span class="macro-value">${meal.macros.carbs}g</span></div>
                <div class="macro-item"><span class="macro-label">Fat</span><span class="macro-value">${meal.macros.fat}g</span></div>
              </div>
            </div>`;
        });
        html += '</div>';
      } else {
        html += '<p class="error">No recommendations available</p>';
      }
      return html;
    }
  </script>
</body>

</html>